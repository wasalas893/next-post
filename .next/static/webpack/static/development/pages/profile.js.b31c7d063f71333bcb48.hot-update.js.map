{"version":3,"file":"static/webpack/static\\development\\pages\\profile.js.b31c7d063f71333bcb48.hot-update.js","sources":["webpack:///./pages/profile.js"],"sourcesContent":["import Paper from \"@material-ui/core/Paper\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Typography from \"@material-ui/core/Typography\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport Divider from \"@material-ui/core/Divider\";\nimport Edit from \"@material-ui/icons/Edit\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\nimport Link from \"next/link\";\n\nimport ProfileTabs from \"../components/profile/ProfileTabs\";\nimport DeleteUser from \"../components/profile/DeleteUser\";\nimport FollowUser from \"../components/profile/FollowUser\";\nimport { authInitialProps } from \"../lib/auth\";\nimport {\n  getUser,\n  getPostsByUser,\n  deletePost,\n  likePost,\n  unlikePost,\n  addComment,\n  deleteComment\n} from \"../lib/api\";\n\nclass Profile extends React.Component {\n  state = {\n    user: null,\n    posts: [],\n    isAuth: false,\n    isFollowing: false,\n    isLoading: true,\n    isDeletingPost: false\n  };\n\n  componentDidMount() {\n    const { userId, auth } = this.props;\n\n    getUser(userId).then(async user => {\n      const isAuth = auth.user._id === userId;\n      const isFollowing = this.checkFollow(auth, user);\n      const posts = await getPostsByUser(userId);\n      this.setState({\n        user,\n        posts,\n        isAuth,\n        isFollowing,\n        isLoading: false\n      });\n    });\n  }\n\n  checkFollow = (auth, user) => {\n    return (\n      user.followers.findIndex(follower => follower._id === auth.user._id) > -1\n    );\n  };\n\n  toggleFollow = sendRequest => {\n    const { userId } = this.props;\n    const { isFollowing } = this.state;\n\n    sendRequest(userId).then(() => {\n      this.setState({ isFollowing: !isFollowing });\n    });\n  };\n\n  handleDeletePost = deletedPost => {\n    this.setState({ isDeletingPost: true });\n    deletePost(deletedPost._id)\n      .then(postData => {\n        const postIndex = this.state.posts.findIndex(\n          post => post._id === postData._id\n        );\n        const updatedPosts = [\n          ...this.state.posts.slice(0, postIndex),\n          ...this.state.posts.slice(postIndex + 1)\n        ];\n        this.setState({\n          posts: updatedPosts,\n          isDeletingPost: false\n        });\n      })\n      .catch(err => {\n        console.error(err);\n        this.setState({ isDeletingPost: false });\n      });\n  };\n\n  handleToggleLike = post => {\n    const { auth } = this.props;\n\n    const isPostLiked = post.likes.includes(auth.user._id);\n    const sendRequest = isPostLiked ? unlikePost : likePost;\n    sendRequest(post._id)\n      .then(postData => {\n        const postIndex = this.state.posts.findIndex(\n          post => post._id === postData._id\n        );\n        const updatedPosts = [\n          ...this.state.posts.slice(0, postIndex),\n          postData,\n          ...this.state.posts.slice(postIndex + 1)\n        ];\n        this.setState({ posts: updatedPosts });\n      })\n      .catch(err => console.error(err));\n  };\n\n  handleAddComment = (postId, text) => {\n    const comment = { text };\n    addComment(postId, comment)\n      .then(postData => {\n        const postIndex = this.state.posts.findIndex(\n          post => post._id === postData._id\n        );\n        const updatedPosts = [\n          ...this.state.posts.slice(0, postIndex),\n          postData,\n          ...this.state.posts.slice(postIndex + 1)\n        ];\n        this.setState({ posts: updatedPosts });\n      })\n      .catch(err => console.error(err));\n  };\n\n  handleDeleteComment = (postId, comment) => {\n    deleteComment(postId, comment)\n      .then(postData => {\n        const postIndex = this.state.posts.findIndex(\n          post => post._id === postData._id\n        );\n        const updatedPosts = [\n          ...this.state.posts.slice(0, postIndex),\n          postData,\n          ...this.state.posts.slice(postIndex + 1)\n        ];\n        this.setState({ posts: updatedPosts });\n      })\n      .catch(err => console.error(err));\n  };\n\n  render() {\n    const { classes, auth } = this.props;\n    const {\n      isLoading,\n      posts,\n      user,\n      isAuth,\n      isFollowing,\n      isDeletingPost\n    } = this.state;\n\n    return (\n      <Paper className={classes.root} elevation={4}>\n        <Typography\n          variant=\"h4\"\n          component=\"h1\"\n          align=\"center\"\n          className={classes.title}\n          gutterBottom\n        >\n          Profile\n        </Typography>\n\n        {isLoading ? (\n          <div className={classes.progressContainer}>\n            <CircularProgress\n              className={classes.progress}\n              size={55}\n              thickness={5}\n            />\n          </div>\n        ) : (\n          <List dense>\n            <ListItem>\n              <ListItemAvatar>\n                <Avatar src={user.avatar} className={classes.bigAvatar} />\n              </ListItemAvatar>\n              <ListItemText primary={user.name} secondary={user.email} />\n\n              {/* Auth - Edit Buttons / UnAuth - Follow Buttons */}\n              {isAuth ? (\n                <ListItemSecondaryAction>\n                  <Link href=\"/edit-profile\">\n                    <a>\n                      <IconButton color=\"primary\">\n                        <Edit />\n                      </IconButton>\n                    </a>\n                  </Link>\n                  <DeleteUser user={user} />\n                </ListItemSecondaryAction>\n              ) : (\n                <FollowUser\n                  isFollowing={isFollowing}\n                  toggleFollow={this.toggleFollow}\n                />\n              )}\n            </ListItem>\n            <Divider />\n            <ListItem>\n              <ListItemText\n                primary={user.about}\n                secondary={`Joined: ${user.createdAt}`}\n              />\n            </ListItem>\n\n           \n          </List>\n        )}\n      </Paper>\n    );\n  }\n}\n\nconst styles = theme => ({\n  root: {\n    padding: theme.spacing.unit * 3,\n    marginTop: theme.spacing.unit * 5,\n    margin: \"auto\",\n    [theme.breakpoints.up(\"sm\")]: {\n      width: 600\n    }\n  },\n  title: {\n    color: theme.palette.primary.main\n  },\n  progress: {\n    margin: theme.spacing.unit * 2\n  },\n  progressContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"column\"\n  },\n  bigAvatar: {\n    width: 60,\n    height: 60,\n    margin: 10\n  }\n});\n\nProfile.getInitialProps = authInitialProps(true);\n\nexport default withStyles(styles)(Profile);\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AASA;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAyBA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAIA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAIA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAIA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;;;;;;AA1GA;AAAA;AACA;AADA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAYA;;;AA4FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAWA;AAAA;AAEA;AACA;AACA;AAHA;AAOA;AAAA;AAGA;AAAA;AAAA;AAEA;AAAA;AAAA;AAKA;AAAA;AAEA;AAAA;AAKA;AAAA;AAIA;AACA;AAFA;AASA;AACA;AAFA;AAWA;;;;AA5LA;AACA;AA8LA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AADA;AAIA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AAHA;AArBA;AAAA;AACA;AA2BA;AAEA;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}